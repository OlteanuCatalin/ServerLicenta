<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Sensor Graphs</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  <!-- ✅ Load Chart.js -->
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        canvas { max-width: 700px; margin: 20px auto; }
    </style>
</head>
<body>
    <h1>Real-Time Sensor Graphs</h1>
    <p><a href="/display">View Data Tables</a></p>  <!-- ✅ Link to Tables -->

    <!-- ✅ Graphs on the Main Page -->
    <h2>LPG Levels Over Time</h2>
    <canvas id="lpgChart"></canvas>

    <h2>CO Levels Over Time</h2>
    <canvas id="coChart"></canvas>

    <h2>Methane Levels Over Time</h2>
    <canvas id="methaneChart"></canvas>

    <script>
        // ✅ Initialize Graphs
        const ctxLPG = document.getElementById("lpgChart").getContext("2d");
        const ctxCO = document.getElementById("coChart").getContext("2d");
        const ctxMethane = document.getElementById("methaneChart").getContext("2d");

        let lpgChart = new Chart(ctxLPG, {
            type: "line",
            data: { labels: [], datasets: [{ label: "LPG (ppm)", borderColor: "red", data: [] }] },
            options: { responsive: true }
        });

        let coChart = new Chart(ctxCO, {
            type: "line",
            data: { labels: [], datasets: [{ label: "CO (ppm)", borderColor: "blue", data: [] }] },
            options: { responsive: true }
        });

        let methaneChart = new Chart(ctxMethane, {
            type: "line",
            data: { labels: [], datasets: [{ label: "Methane (ppm)", borderColor: "green", data: [] }] },
            options: { responsive: true }
        });

        function fetchSensorData() {
            fetch('/data')  // ✅ Request JSON data from Flask
                .then(response => response.json())
                .then(data => {
                    const timestamps = data.mq2_sensor.map(row => row.timestamp).reverse();  // ✅ Time labels

                    // ✅ Update LPG Chart
                    lpgChart.data.labels = timestamps;
                    lpgChart.data.datasets[0].data = data.mq2_sensor.map(row => row.LPG).reverse();
                    lpgChart.update();

                    // ✅ Update CO Chart
                    coChart.data.labels = timestamps;
                    coChart.data.datasets[0].data = data.mq2_sensor.map(row => row.CO).reverse();
                    coChart.update();

                    // ✅ Update Methane Chart
                    methaneChart.data.labels = timestamps;
                    methaneChart.data.datasets[0].data = data.mq2_sensor.map(row => row.Methane).reverse();
                    methaneChart.update();
                })
                .catch(error => console.error("Error fetching data:", error));
        }

        // ✅ Auto-refresh data every 5 seconds
        setInterval(fetchSensorData, 5000);
        fetchSensorData();  // ✅ Load data immediately on page load
    </script>
</body>
</html>
